<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking normalization, aggregation and models using the Ionstar Dataset • prolfqua</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking normalization, aggregation and models using the Ionstar Dataset">
<meta property="og:description" content="prolfqua">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prolfqua</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Auxiliary_ExDesignSurvey.html">Auxiliary - Bioinformatics Project Meeting Agenda</a>
    </li>
    <li>
      <a href="../articles/Auxiliary_LFQSurvey.html">Auxiliary - Project meeting (bioinfo) Agenda</a>
    </li>
    <li>
      <a href="../articles/Auxiliary_prolfquaAbstract_2.html">Auxiliary - Euro Bioconductor 2020</a>
    </li>
    <li>
      <a href="../articles/Auxiliary_prolfquaAbstract_BioC2021.html">Auxiliary - Prolfqua - R package for visualization and modelling of proteomics label-free quantification data</a>
    </li>
    <li>
      <a href="../articles/BenchmarkingIonstarData.html">Benchmarking normalization, aggregation and models using the Ionstar Dataset</a>
    </li>
    <li>
      <a href="../articles/BenchmarkMSFraggerProteinIonStar.html">Benchmarking MSFragger output using Ionstar Dataset</a>
    </li>
    <li>
      <a href="../articles/Comparing2Groups.html">Comparing Two Groups</a>
    </li>
    <li>
      <a href="../articles/CreatingConfigurations.html">Creating prolfqua Configurations</a>
    </li>
    <li>
      <a href="../articles/Modelling2Factors.html">Modelling Dataset with two Factors.</a>
    </li>
    <li>
      <a href="../articles/MSStatsBenchmark.html">Benchmarking MSstats using the Ionstar Dataset</a>
    </li>
    <li>
      <a href="../articles/Preprocessing2Factors.html">Preprocessing Dataset with two Factors.</a>
    </li>
    <li>
      <a href="../articles/QCandSampleSize.html">Quality Control &amp; Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/QualityControlAndSampleSizeEstimation.html">QC and Sample Size Estimation</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary.html">Supplement - Summarize SRM Peptide Level Measurements</a>
    </li>
    <li>
      <a href="../articles/Supplement_srm_summary_HL.html">Supplement - Summarize heavy light Peptide Level Measurements</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_HL_Skyline.html">Supplement - Data preprocessing of SRM Heavy Light data</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyAnalysis_Skyline_PRM.html">Supplement - Data preprocessing for PRM</a>
    </li>
    <li>
      <a href="../articles/Supplement_TidyCorrelationAnalysis.html">Supplement - Filter precursors or fragments based on correlation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wolski/prolfqua/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="BenchmarkingIonstarData_files/header-attrs-2.8/header-attrs.js"></script><script src="BenchmarkingIonstarData_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Benchmarking normalization, aggregation and models using the Ionstar Dataset</h1>
                        <h4 class="author">FGCZ - (Draft)</h4>
            
            <h4 class="date">20 May, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wolski/prolfqua/blob/master/vignettes/BenchmarkingIonstarData.Rmd"><code>vignettes/BenchmarkingIonstarData.Rmd</code></a></small>
      <div class="hidden name"><code>BenchmarkingIonstarData.Rmd</code></div>

    </div>

    
    
<p>Please download and install the <code>prolfquaData</code> package from github</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/conflicted">conflicted</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wolski/prolfqua">prolfqua</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="fu">conflicted</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/conflicted/man/conflict_prefer.html">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span><span class="op">)</span></code></pre></div>
<p>Decide if you work with all data or for speedup with subset of data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SUBSET</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></code></pre></div>
<p>We start by loading the IonStar dataset and the annotation from the <code>prolfquaData</code> package. The method <code>add_annotation</code> adds the annotation to the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html">find.package</a></span><span class="op">(</span><span class="st">"prolfquaData"</span><span class="op">)</span> , <span class="st">"quantdata"</span><span class="op">)</span>
<span class="va">inputMQfile</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">datadir</span>,
                          <span class="st">"MAXQuant_IonStar2018_PXD003881.zip"</span><span class="op">)</span>
<span class="va">inputAnnotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"annotation_Ionstar2018_PXD003881.xlsx"</span><span class="op">)</span>
<span class="va">mqdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidyMQ_Peptides_Config.html">tidyMQ_Peptides_Config</a></span><span class="op">(</span><span class="va">inputMQfile</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"CON_"</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">top_protein</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.0104178</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="va">inputAnnotation</span><span class="op">)</span>


<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_annotation.html">add_annotation</a></span><span class="op">(</span>
  <span class="va">mqdata</span><span class="op">$</span><span class="va">data</span>,
  <span class="va">annotation</span>,
  fileName <span class="op">=</span> <span class="st">"raw.file"</span>
<span class="op">)</span></code></pre></div>
<p>The <code>setup_analysis</code> asserts that all columns specified in the configruation are present in the data. For more details about the proflqua configuration see the vignette “Creating Configurations”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"dilution."</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"sample"</span>
<span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"run_Id"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"run_ID"</span>
<span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factorDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">mqdata</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_analysis.html">setup_analysis</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datafilt</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_proteins_by_peptide_count.html">filter_proteins_by_peptide_count</a></span><span class="op">(</span><span class="va">mqdata</span><span class="op">$</span><span class="va">data</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">datafilt</span><span class="op">$</span><span class="va">protein_Id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 4070</code></pre>
<div id="data-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#data-normalization" class="anchor"></a>Data normalization</h2>
<p>We will normalize the data using the ‘LFQTransformer’ class. Since we know that the Human proteins are the Matrix in the experiment we will normalize the data using HUMAN proteins only. To this task we subset the dataset by filtering for HUMAN proteins only and then use the ‘log2_robscale_subset’ method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lfqdata</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LFQData.html">LFQData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">datafilt</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">)</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Transformer</span><span class="op">(</span><span class="op">)</span>

<span class="va">subset_h</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span>
<span class="va">subset_h</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">subset_h</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"HUMAN"</span>, <span class="va">protein_Id</span><span class="op">)</span><span class="op">)</span>
<span class="va">lfqdataNormalized</span> <span class="op">&lt;-</span> <span class="va">tr</span><span class="op">$</span><span class="fu">log2_robscale_subset</span><span class="op">(</span>lfqsubset <span class="op">=</span> <span class="va">subset_h</span><span class="op">)</span></code></pre></div>
<p>The figures below show the intensity distribution before and after normalization.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">before</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">before</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/plotIntensityDistributions-1.png" width="480"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">after</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">after</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/plotIntensityDistributions-2.png" width="480"></p>
<p>Create a sample of N proteins to speed up computations of models and contrasts.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="va">SUBSET</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span>
  <span class="va">mqdataSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_sample</span><span class="op">(</span>size <span class="op">=</span> <span class="va">N</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span>
  <span class="va">lfqNormSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">get_sample</span><span class="op">(</span>size <span class="op">=</span> <span class="va">N</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span>
  <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">hierarchy_counts</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="va">mqdataSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span>
  <span class="va">lfqNormSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="inferring-protein-intensities" class="section level1">
<h1 class="hasAnchor">
<a href="#inferring-protein-intensities" class="anchor"></a>Inferring Protein intensities</h1>
<p>We will be using the <code>LFQDataAggregator</code> class. To estimate protein intensities using Tukey’s median polish we need to use log2 transformed peptide intensities. The figure below shows the the peptide intensities used for estimation and the protein intensity estimates (black dashed line).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lfqAggMedpol</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LFQDataAggregator.html">LFQDataAggregator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">lfqNormSubset</span>, <span class="st">"protein"</span><span class="op">)</span>
<span class="va">lfqAggMedpol</span><span class="op">$</span><span class="fu">medpolish</span><span class="op">(</span><span class="op">)</span>
<span class="va">xx</span> <span class="op">&lt;-</span> <span class="va">lfqAggMedpol</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span>
<span class="va">xx</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/aggregateMedpolish-1.png" width="480"></p>
<p>We can also estimate the protein intensities using the top N most abundant peptides. In this case we are using the untransformed protein intensities. The figure below shows the estimated protein intensities.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lfqAggregator</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LFQDataAggregator.html">LFQDataAggregator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mqdataSubset</span>, <span class="st">"protein_topN"</span><span class="op">)</span>
<span class="va">lfqAggregator</span><span class="op">$</span><span class="fu">mean_topN</span><span class="op">(</span><span class="op">)</span>
<span class="va">topN</span> <span class="op">&lt;-</span> <span class="va">lfqAggregator</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span>
<span class="va">topN</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
</div>
<div id="model-fitting" class="section level1">
<h1 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model Fitting</h1>
<div id="model-1-fitting-a-linear-model-to-the-protein-intensities" class="section level2">
<h2 class="hasAnchor">
<a href="#model-1-fitting-a-linear-model-to-the-protein-intensities" class="anchor"></a>Model 1 : Fitting a linear model to the protein intensities</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">protLFQ</span> <span class="op">&lt;-</span> <span class="va">lfqAggMedpol</span><span class="op">$</span><span class="va">lfq_agg</span>

<span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution."</span>
<span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">protLFQ</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">getWorkIntensity</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span>

<span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strategy_lm.html">strategy_lm</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span>

<span class="va">modLinearProt</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">protLFQ</span><span class="op">$</span><span class="va">data</span>, <span class="va">modelFunction</span><span class="op">)</span>
<span class="va">modLinearProt</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelLM-1.png" width="480"></p>
</div>
<div id="model-2-fitting-a-mixed-effects-model-to-peptide-intensities" class="section level2">
<h2 class="hasAnchor">
<a href="#model-2-fitting-a-mixed-effects-model-to-peptide-intensities" class="anchor"></a>Model 2: Fitting a mixed effects model to peptide intensities</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution. + (1|peptide_Id) + (1|sampleName)"</span>
<span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">getWorkIntensity</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span>
<span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strategy_lmer.html">strategy_lmer</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span>
<span class="va">modMixedProtLevel</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">data</span>, <span class="va">modelFunction</span><span class="op">)</span>
<span class="va">modMixedProtLevel</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelLMer-1.png" width="480"></p>
</div>
<div id="model-3-fitting-peptide-level-models" class="section level2">
<h2 class="hasAnchor">
<a href="#model-3-fitting-peptide-level-models" class="anchor"></a>Model 3: Fitting peptide level models</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution."</span>

<span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">2</span>

<span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">getWorkIntensity</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span>

<span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strategy_lm.html">strategy_lm</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span>
<span class="va">modLMPepLevel</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">data</span>,
                                       <span class="va">modelFunction</span>,
                                       subject_Id <span class="op">=</span> <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">subject_id</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">modLMPepLevel</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelPeptide-1.png" width="480"></p>
</div>
</div>
<div id="computing-contrasts" class="section level1">
<h1 class="hasAnchor">
<a href="#computing-contrasts" class="anchor"></a>Computing Contrasts</h1>
<p>Once models are fitted contrasts can be computed. The R code below defines all possible contrasts among conditions for the ionstar dataset.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEBUG</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>

<span class="va">Contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"dilution_(9/3)_3"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.a"</span>,
  <span class="st">"dilution_(9/4.5)_2"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.b"</span>,
  <span class="st">"dilution_(9/6)_1.5"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.c"</span>,
  <span class="st">"dilution_(9/7.5)_1.2"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.d"</span>,
  
  <span class="st">"dilution_(7.5/3)_2.5"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.a"</span>,
  <span class="st">"dilution_(7.5/4.5)_1.6(6)"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.b"</span>,
  <span class="st">"dilution_(7.5/6)_1.25"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.c"</span>,
  
  <span class="st">"dilution_(6/3)_2"</span> <span class="op">=</span>   <span class="st">"dilution.c - dilution.a"</span>,
  <span class="st">"dilution_(6/4.5)_1.3(3)"</span> <span class="op">=</span>   <span class="st">"dilution.c - dilution.b"</span>,
  
  <span class="st">"dilution_(4.5/3)_1.5"</span> <span class="op">=</span>   <span class="st">"dilution.b - dilution.a"</span>
<span class="op">)</span>


<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span>,split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ratio"</span> , <span class="st">"expected fold-change"</span><span class="op">)</span>
<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span><span class="va">tt</span>, contrast <span class="op">=</span>  <span class="va">Contrasts</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">tt</span>, caption <span class="op">=</span> <span class="st">"All possible Contrasts given 5 E. coli dilutions of the Ionstar Dataset"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>All possible Contrasts given 5 E. coli dilutions of the Ionstar Dataset</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">contrast</th>
<th align="left">ratio</th>
<th align="left">expected fold-change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">init</td>
<td align="left">dilution.e - dilution.a</td>
<td align="left">(9/3)</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">X</td>
<td align="left">dilution.e - dilution.b</td>
<td align="left">(9/4.5)</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">X.1</td>
<td align="left">dilution.e - dilution.c</td>
<td align="left">(9/6)</td>
<td align="left">1.5</td>
</tr>
<tr class="even">
<td align="left">X.2</td>
<td align="left">dilution.e - dilution.d</td>
<td align="left">(9/7.5)</td>
<td align="left">1.2</td>
</tr>
<tr class="odd">
<td align="left">X.3</td>
<td align="left">dilution.d - dilution.a</td>
<td align="left">(7.5/3)</td>
<td align="left">2.5</td>
</tr>
<tr class="even">
<td align="left">X.4</td>
<td align="left">dilution.d - dilution.b</td>
<td align="left">(7.5/4.5)</td>
<td align="left">1.6(6)</td>
</tr>
<tr class="odd">
<td align="left">X.5</td>
<td align="left">dilution.d - dilution.c</td>
<td align="left">(7.5/6)</td>
<td align="left">1.25</td>
</tr>
<tr class="even">
<td align="left">X.6</td>
<td align="left">dilution.c - dilution.a</td>
<td align="left">(6/3)</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">X.7</td>
<td align="left">dilution.c - dilution.b</td>
<td align="left">(6/4.5)</td>
<td align="left">1.3(3)</td>
</tr>
<tr class="even">
<td align="left">X.8</td>
<td align="left">dilution.b - dilution.a</td>
<td align="left">(4.5/3)</td>
<td align="left">1.5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relevantContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dilution_(9/7.5)_1.2"</span>,
                       <span class="st">"dilution_(7.5/6)_1.25"</span>,
                       <span class="st">"dilution_(6/4.5)_1.3(3)"</span>,
                       <span class="st">"dilution_(4.5/3)_1.5"</span> <span class="op">)</span>

<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">relevantContrasts</span>,split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ratio"</span> , <span class="st">"expected fold-change"</span><span class="op">)</span>
<span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span><span class="va">tt</span>, contrast <span class="op">=</span>  <span class="va">Contrasts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">relevantContrasts</span><span class="op">]</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">tt</span>, caption <span class="op">=</span> <span class="st">"Contrasts used for benchmark."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Contrasts used for benchmark.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">contrast</th>
<th align="left">ratio</th>
<th align="left">expected fold-change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">init</td>
<td align="left">dilution.e - dilution.d</td>
<td align="left">(9/7.5)</td>
<td align="left">1.2</td>
</tr>
<tr class="even">
<td align="left">X</td>
<td align="left">dilution.d - dilution.c</td>
<td align="left">(7.5/6)</td>
<td align="left">1.25</td>
</tr>
<tr class="odd">
<td align="left">X.1</td>
<td align="left">dilution.c - dilution.b</td>
<td align="left">(6/4.5)</td>
<td align="left">1.3(3)</td>
</tr>
<tr class="even">
<td align="left">X.2</td>
<td align="left">dilution.b - dilution.a</td>
<td align="left">(4.5/3)</td>
<td align="left">1.5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relevantContrasts</span> <span class="op">&lt;-</span> <span class="va">Contrasts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">relevantContrasts</span><span class="op">]</span></code></pre></div>
<p>There are, as of today, four contrasts classes in the package <em>prolfqua</em> - ‘ContrastSimpleImputed’ : contrast computation with imputation of fold changes and t-statistic estimation using pooled variances. - ‘Contrast’ : uses Wald test, - ‘ContrastModerated’ : applies variance moderation:, - ‘ContrastROPECA’ implements estimate and p-value aggregation</p>
<div id="contrasts-with-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#contrasts-with-imputation" class="anchor"></a>Contrasts with Imputation</h2>
<p>In order to estimate fold-changes, statistics and p-values of proteins for which linear models could not be fitted because of an excess of missing measurements, the following procedure is applied. The mean intensity of a protein over all samples in a condition is computed. For the proteins with no observation in one condition, we imputed their intensities using the mean of the 10% smallest average peptide intensities. The standard deviation is estimated in the condition where the peptide is observed.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrImp</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/ContrastsSimpleImpute.html">ContrastsSimpleImpute</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">protLFQ</span>, <span class="va">relevantContrasts</span><span class="op">)</span>
<span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>
<span class="va">plc</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">plc</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastImputed-1.png" width="480"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plc</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastImputed-2.png" width="480"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">allContrasts</span><span class="op">$</span><span class="va">imputation</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>
<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">benchmark_imputation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"med. polish and lm. imputation"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_imputation"</span>,
                                   FDRvsFDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sc <span class="op">=</span> <span class="st">"FDR"</span>, desc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">benchmark_imputation</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkImputed-1.png" width="480"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_imputation</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkImputed-2.png" width="480"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_imputation</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">4028</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_imputation</span> <span class="op">&lt;-</span> <span class="va">benchmark_imputation</span></code></pre></div>
</div>
<div id="contrasts-from-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#contrasts-from-model-1" class="anchor"></a>Contrasts from Model 1</h2>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">modLinearProt</span><span class="op">$</span><span class="va">modelDF</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 4070    9</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrProt</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/Contrasts.html">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modLinearProt</span>, <span class="va">relevantContrasts</span><span class="op">)</span>
<span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProt</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">pl</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel1-1.png" width="480"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pl</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel1-2.png" width="480"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allContrasts</span><span class="op">$</span><span class="va">Prot</span> <span class="op">&lt;-</span> <span class="va">contrProt</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>

<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProt</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">ttd</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op">%&gt;%</span> <span class="va">unique</span> <span class="op">%&gt;%</span> <span class="va">length</span></code></pre></div>
<pre><code>## [1] 4030</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_Prot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"med. polish and lm"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_med_lm"</span>
<span class="op">)</span>
<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_Prot</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">3951</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">54</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#benchmark_Prot$plot_score_distribution()</span>
<span class="va">benchmark_Prot</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel1-1.png" width="480"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_Prot</span> <span class="op">&lt;-</span> <span class="va">benchmark_Prot</span></code></pre></div>
<div id="adding-moderation" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-moderation" class="anchor"></a>Adding Moderation</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrProtModerated</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ContrastsModerated.html">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">contrProt</span><span class="op">)</span>
<span class="va">contrProtModerated</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel1Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrProtModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op">%&gt;%</span> <span class="va">unique</span> <span class="op">%&gt;%</span> <span class="va">length</span></code></pre></div>
<pre><code>## [1] 4070</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allContrasts</span><span class="op">$</span><span class="va">ProtModerated</span> <span class="op">&lt;-</span> <span class="va">contrProtModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>

<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProtModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">benchmark_ProtModerated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"med. polish and lm moderated"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_med_lm_moderated"</span><span class="op">)</span>

<span class="co">#benchmark_ProtModerated$plot_score_distribution()</span>
<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_ProtModerated</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>,
                       caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">3951</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">54</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_ProtModerated</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel1Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_ProtModerated</span> <span class="op">&lt;-</span> <span class="va">benchmark_ProtModerated</span></code></pre></div>
</div>
</div>
<div id="contrasts-from-model-2" class="section level2">
<h2 class="hasAnchor">
<a href="#contrasts-from-model-2" class="anchor"></a>Contrasts from Model 2</h2>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrProtMixed</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/Contrasts.html">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modMixedProtLevel</span>, <span class="va">relevantContrasts</span>, modelName <span class="op">=</span> <span class="st">"WaldTestMixed"</span><span class="op">)</span>

<span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span>
<span class="va">pl</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2-1.png" width="480"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pl</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2-2.png" width="480"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>
<span class="va">pl</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op">%&gt;%</span> <span class="va">unique</span> <span class="op">%&gt;%</span> <span class="va">length</span></code></pre></div>
<pre><code>## [1] 3979</code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allContrasts</span><span class="op">$</span><span class="va">contrProtMixed</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>
<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">benchmark_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"mixed effect model"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_mixed_effect"</span>
<span class="op">)</span>
<span class="va">benchmark_mixed</span><span class="op">$</span><span class="fu">complete</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_mixed</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">0</td>
<td align="right">3939</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#benchmark_mixed$plot_score_distribution()</span>
<span class="va">benchmark_mixed</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel2-1.png" width="480"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_mixed</span> <span class="op">&lt;-</span> <span class="va">benchmark_mixed</span></code></pre></div>
<div id="adding-moderation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-moderation-1" class="anchor"></a>Adding Moderation</h3>
<p>Since moderation requires a good degrees of freedom estimate to estimate the prior degrees of freedom we examine the denominator degrees of freedom produced by the methods implemented in lmerTest (see Histogram).</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctr</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">ctr</span><span class="op">$</span><span class="va">df</span>
<span class="va">df</span><span class="op">[</span><span class="va">df</span> <span class="op">&gt;</span> <span class="fl">59</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">60</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  1.404191 60.000000</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">df</span>, breaks <span class="op">=</span> <span class="fl">100</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">61</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/distributionOfDFModel2-1.png" alt="Histogram of degrees of freedom for mixed model" width="480"><p class="caption">
Histogram of degrees of freedom for mixed model
</p>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrProtMixedModerated</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ContrastsModerated.html">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">contrProtMixed</span><span class="op">)</span>
<span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allContrasts</span><span class="op">$</span><span class="va">contrProtMixedModerated</span> <span class="op">&lt;-</span> <span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>

<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">benchmark_mixedModerated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"mixed effect model moderated"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_mixed_effect_moderated"</span><span class="op">)</span>

<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_mixedModerated</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">0</td>
<td align="right">3939</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#benchmark_mixedModerated$plot_score_distribution()</span>
<span class="va">benchmark_mixedModerated</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel2Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_mixedModerated</span> <span class="op">&lt;-</span> <span class="va">benchmark_mixedModerated</span></code></pre></div>
</div>
</div>
<div id="protein-level-contrasts-from-peptide-models" class="section level2">
<h2 class="hasAnchor">
<a href="#protein-level-contrasts-from-peptide-models" class="anchor"></a>Protein level contrasts from Peptide models</h2>
<p>To estimate regulation probabilities using the ROPECA approach we can chain the contrast computation methods. First we compute contrasts on peptide level, than we moderated the variance, t-statistics and p-values and finally we aggregate the fold change estimates and p-values.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrROPECA</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="../reference/Contrasts.html">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modLMPepLevel</span>, <span class="va">relevantContrasts</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va"><a href="../reference/ContrastsModerated.html">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va"><a href="../reference/ContrastsROPECA.html">ContrastsROPECA</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $FDR.beta.based.significance</code></pre>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastROPECA-1.png" width="480"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastROPECA-2.png" width="480"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#View(contrROPECA$get_contrasts())</span>
<span class="va">allContrasts</span><span class="op">$</span><span class="va">contrProtMixedModerated</span> <span class="op">&lt;-</span> <span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span>

<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">benchmark_ropeca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                toscale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta.based.significance"</span><span class="op">)</span>,
                                benchmark <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sc <span class="op">=</span> <span class="st">"estimate"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sc <span class="op">=</span> <span class="st">"statistic"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sc <span class="op">=</span> <span class="st">"scaled.beta.based.significance"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
                                <span class="op">)</span>,  
                                model_description <span class="op">=</span> <span class="st">"Ropeca"</span>,
                                model_name <span class="op">=</span> <span class="st">"ropeca"</span>,
                                FDRvsFDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sc <span class="op">=</span> <span class="st">"FDR.beta.based.significance"</span>, desc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>


<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_ropeca</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">3925</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">59</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_ropeca</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkROPECA-1.png" width="480"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_ropeca</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkROPECA-2.png" width="480"></p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_ropeca</span> <span class="op">&lt;-</span> <span class="va">benchmark_ropeca</span></code></pre></div>
</div>
<div id="merging-contrasts" class="section level2">
<h2 class="hasAnchor">
<a href="#merging-contrasts" class="anchor"></a>Merging contrasts</h2>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/addContrastResults.html">addContrastResults</a></span><span class="op">(</span>prefer <span class="op">=</span> <span class="va">contrProtMixedModerated</span>, add <span class="op">=</span> <span class="va">contrImp</span><span class="op">)</span>
<span class="va">allContrasts</span><span class="op">$</span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="va">merged</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">allContrasts</span>, file <span class="op">=</span> <span class="st">"../inst/Benchresults/allContrasts.RDS"</span><span class="op">)</span>

<span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/ionstar_bench_preprocess.html">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>
<span class="va">benchmark_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_benchmark.html">make_benchmark</a></span><span class="op">(</span><span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,
                                   model_description <span class="op">=</span> <span class="st">"merge of prot moderated and imputed"</span>,
                                   model_name <span class="op">=</span> <span class="st">"prot_merged"</span><span class="op">)</span>

<span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="../reference/table_facade.html">table_facade</a></span><span class="op">(</span><span class="va">benchmark_merged</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of estimated contrasts."</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of estimated contrasts.</caption>
<thead><tr class="header">
<th align="left">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">4028</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#benchmark_mixedModerated$plot_score_distribution()</span>
<span class="va">benchmark_merged</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">benchmark_merged</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-3-2.png" width="480"></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_merged</span> <span class="op">&lt;-</span> <span class="va">benchmark_merged</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, file <span class="op">=</span> <span class="st">"../inst/Benchresults/allBenchmarkds.RDS"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="benchmarking" class="section level1">
<h1 class="hasAnchor">
<a href="#benchmarking" class="anchor"></a>Benchmarking</h1>
<p>The table below summarizes the contrast estimates produced which will be benchmarked.</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="center">Model</th>
<th>Contrast</th>
<th>Moderation</th>
<th>Aggregation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Protein Intensity</td>
<td align="center">lm</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="even">
<td>Protein Intensity Imputed</td>
<td align="center">pooled variance</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="odd">
<td>Peptide Intensity</td>
<td align="center">lmer</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="even">
<td>Peptide Intensity</td>
<td align="center">lm</td>
<td></td>
<td></td>
<td>o</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ttt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="fu">complete</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">map_df</span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="fu">pAUC</span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">resAllB</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">contrast</span> <span class="op">==</span> <span class="st">"all"</span><span class="op">)</span>

<span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">resAllB</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>whatfix <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">what</span> <span class="op">==</span> <span class="st">"scaled.beta.based.significance"</span> <span class="op">~</span> <span class="st">"scaled.p.value"</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">what</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Name</span>, y <span class="op">=</span> <span class="va">pAUC_10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">whatfix</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">82.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-4-1.png" alt="Partial area under the ROC curve at 10% FPR." width="480"><p class="caption">
Partial area under the ROC curve at 10% FPR.
</p>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Name</span>, y <span class="op">=</span> <span class="va">pAUC_20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">whatfix</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">87.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<div id="look-at-the-nr-of-estimated-contrasts-" class="section level3">
<h3 class="hasAnchor">
<a href="#look-at-the-nr-of-estimated-contrasts-" class="anchor"></a>Look at the nr of estimated contrasts.</h3>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">map_df</span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>; <span class="va">res</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">model_name</span>;<span class="va">res</span><span class="op">}</span><span class="op">)</span>
<span class="va">dd</span><span class="op">$</span><span class="va">nr_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">dd</span><span class="op">$</span><span class="va">nr_missing</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>
<span class="va">dd</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nrcontrasts <span class="op">=</span> <span class="va">protein_Id</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span><span class="op">-</span><span class="va">nr_missing</span><span class="op">)</span><span class="op">)</span>
<span class="va">dds</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>nrcontrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nrcontrasts</span><span class="op">)</span><span class="op">)</span>

<span class="va">dds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">nrcontrasts</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">nrcontrasts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">nrcontrasts</span><span class="op">)</span>, position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>, vjust<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-6-1.png" alt="NR of estimated contrasts" width="480"><p class="caption">
NR of estimated contrasts
</p>
</div>
</div>
<div id="plot-fdr-vs-fdp" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-fdr-vs-fdp" class="anchor"></a>Plot FDR vs FDP</h3>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">map_df</span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">get_FDRvsFDP</span><span class="op">(</span><span class="op">)</span>; <span class="va">res</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">model_name</span>;<span class="va">res</span><span class="op">}</span><span class="op">)</span>

<span class="va">dd</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">FDP_</span>,  x  <span class="op">=</span> <span class="va">scorecol</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">contrast</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/FDRfdp-1.png" alt="Compare FDR estimate with false discovery proportion (FDP)." width="768"><p class="caption">
Compare FDR estimate with false discovery proportion (FDP).
</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Witold Wolski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
